{% extends 'garderie/base.html' %}

{% block title %}Liste des enfants{% endblock %}

{% load static %}
{% block scripts %}
<script type="text/javascript">


	var csrf="{{csrf_token}}";
	var url_in="{% url 'ajax_arrival' %}";
	var url_out="{% url 'ajax_departure' %}";
	var url_update_departure="{% url 'ajax_edit_departure' %}";
	var url_update_arrival="{% url 'ajax_edit_arrival' %}";
	var url_remove_arrival="{% url 'ajax_remove_arrival' %}";

	let data_tab1 = $('#table1').DataTable({
			    		"ordering": true,
			    		paging: false,
			    		"order": [[ 1, "asc" ]],
			    		"columnDefs": [
			    			{ className: "in_arrival", "targets":[2] },
			    			{ className: "in_departure", "targets":[3]}
			    		],
			    		"language": {
						    "emptyTable": "Aucun enfant n'est présent actuellement",
						    "search":         "Rechercher :",
						    "info":           "Données _START_ à _END_ sur _TOTAL_ entrées",
    						"infoEmpty":      "Pas encore de données",

    						"infoFiltered":   "(filtré depuis _MAX_ entrées totales)",
    						"lengthMenu":     "Montre _MENU_ entrées",
						    "loadingRecords": "Chargement...",
						    "processing":     "Execution...",
						    "zeroRecords":    "Aucune correspondance trouvée"
						}
		    		});

	let data_tab2 = $('#table2').DataTable({
			    		"ordering": true,
			    		paging: false,
			    		"order": [[ 0, "asc" ]],
			    		"language": {
						    "emptyTable": "Aucun enfant n'est enregistré",
						    "search":         "Rechercher :",
						    "info":           "Données _START_ à _END_ sur _TOTAL_ entrées",
    						"infoEmpty":      "Pas encore de données",

    						"infoFiltered":   "(filtré depuis _MAX_ entrées totales)",
    						"lengthMenu":     "Montre _MENU_ entrées",
						    "loadingRecords": "Chargement...",
						    "processing":     "Execution...",
						    "zeroRecords":    "Aucune correspondance trouvée"
						}
			    	});

</script>
<script src="{% static '/garderie/js/child_list.js/' %}"></script>

{% endblock %}
{% block body %}

<div class="container">
	<h1>Liste des enfants présents</h1>
	<table id="table1" class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Options</th>
				<th>Enfant</th>
				<th>Arrivée</th>
				<th>Départ</th>
			</tr>
		</thead>
		<tbody>
		{% for child in children_list.all_children %}
			{% if child.present_next_time or child.incomplete_schedule or child.was_here %}
				{% with schedule=child.schedule_to_display %}
				<tr class="child_in" data-cid="{{child.id}}" data-sid="{{schedule.id}}" >
					<td> {% if schedule %}
						<button class="btn btn-danger btn-sm" onclick="removeArrival({{ schedule.id }})">x</button>
							{% endif %}
					</td>
					<td>
						<a href="{% url 'child_profile' child.id %}">
								{{child.first_name}}
						</a>
					</td> 
					<td> {% if schedule %}
						<input type="time"class="input_arrival" required value="{{schedule.arrival |default_if_none:''|date:"G:i"}}"></input>
							{% else %}
								<button class="button_in_arrival">Arrivée</button>
							
							{% endif %}
							
					</td>
					<td> {% if schedule and schedule.departure %}
						<input type="time"class="input_departure" required value="{{schedule.departure |default_if_none:''|date:"G:i"}}"></input>
							{% elif schedule and schedule.arrival %}
								<button class="button_in_departure">Départ</button>
							
							{% endif %}
					</td>
				</tr>
				{% endwith %}
			{% endif %}
		{% endfor %}
		</tbody>
	</table>


	<h1>Liste des enfants</h1>
	<table id="table2" class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Enfant</th>
				<th></th>
				{% if user.is_superuser %}
					<th>Options</th>
				{% endif %}
			</tr>
		</thead>
		<tbody>
			{% for child in children_list.all_children %}
			<tr class="child_out" data-cid="{{child.id}}">
				<td>
					<a href="{% url 'child_profile' child.id %}">
							{{child.fullname}}
					</a>
				</td> 
				<td>
					<button type="button" class="button_out_arrival">Arrivée</button>
				</td>				
				{% if user.is_superuser %}
					<td> 
						<form method="POST" action="{% url 'child_delete' child.id  %}">
			 				{% csrf_token %}
				 				<input type="submit" value="X" class="btn btn-danger btn-sm">
							</form>
					</td> 
					{% endif %}				
				</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endblock %}


