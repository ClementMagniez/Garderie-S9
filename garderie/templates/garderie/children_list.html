{% extends 'garderie/base.html' %}

{% block title %}Liste des enfants{% endblock %}

{% load static %}
{% block scripts %}
<script src="{% static '/garderie/js/child_list.js/' %}"></script>
<script>
	var csrf="{{csrf_token}}";
	var url_in="{% url 'ajax_arrival' %}";
	var url_out="{% url 'ajax_departure' %}";
	var url_edit="{% url 'ajax_edit_departure' %}";
	var url_remove_arrival="{% url 'ajax_remove_arrival' %}";
</script>
{% endblock %}
{% block body %}

<div class="container">
	<h1>Liste des enfants présents</h1>
	<table id="table1" class="table table-striped">
		<thead>
			<tr>
				<th colspan="2">Enfant</th>
				<th>Arrivée</th>
				<th colspan="2">Départ</th>
			</tr>
		</thead>
			{% for schedule in children_list.current_schedules %}
				{% with child=schedule.child %}

					<tr class="child_in" data-value="{{child.id}}">
						<td> <button class="btn btn-danger btn-sm" onclick="removeArrival({{ schedule.id }})">x</button>
						</td>
						<td>
							<a href="{% url 'child_profile' child.id %}">
									{{child.fullname}}
							</a>
						</td> 
						<td class="in_arrival">
							{{schedule.arrival |default_if_none:''|date:"G:i"}}
						</td>
						<td class="in_departure"></td>
						<td></td>
					</tr>
				{% endwith %}
			{% endfor %}
		<tbody>
		</tbody>
	</table>

	<h1>Liste des enfants</h1>
	<table id="table2" class="table table-striped">
		<thead>
			<tr>
				<th>Enfant</th>
				<th>Prochain horaire de présence</th>
			</tr>
		</thead>
		<tbody>
			{% for child in children_list.all_children %}
				<tr class="child_out" data-value="{{child.id}}">
					<td>
							<form method="POST" action="{% url 'child_delete' child.id  %}">
						{% if user.is_superuser %}
			 				{% csrf_token %}
				 				<input type="submit" value="X" class="btn btn-danger btn-sm">
						{% endif %}				
								<a href="{% url 'child_profile' child.id %}">
									{{child.fullname}}
								</a>
							</form>
					</td> 
					<td>
						{% with presence=child.next_presence %}
							{{ presence.0|date:'l d/m'|default_if_none:''}}
							{% if presence.1 %}
								{{ presence.1.get_period_display|lower }}
							{% endif %}
						{% endwith %}
					</td>				
				</tr>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endblock %}
