{% extends 'garderie/base.html' %}
{% block title %}Profil de {{ parent.uid.first_name }} {{parent.uid.last_name}}{% endblock %}

{% block scripts %}
<script type="text/javascript">

	var data_tab = $('#parent_profile_enfant_tab').DataTable({
			    		"ordering": true,
			    		paging: false,
			    		"order": [[ 0, "asc" ]],
			    		"searching": false,
			    		"columnDefs": [
						    { "width": "80%", "targets": 0 }
						  ],
						  "language": {
						    "emptyTable": "Aucun enfant n'est enregistré",
						    "search":         "Rechercher :",
						    "info":           "",
    						"infoEmpty":      ""
						}
		    		});

	var data_tab_fac = $('#parent_profile_confiance_tab').DataTable({
			    		"ordering": true,
			    		paging: false,
			    		"order": [[ 0, "asc" ]],
			    		"searching": false,
			    		"columnDefs": [
						    { "width": "80%", "targets": 0 }
						  ],
						  "language": {
						    "emptyTable": "Aucune personne de confiance n'est enregistrée",
						    "search":         "Rechercher :",
						    "info":           "",
    						"infoEmpty":      ""
						}		    		
		    		});

	var data_tab_conf = $('#parent_profile_facture_tab').DataTable({
			    		"ordering": true,
			    		paging: false,
			    		"order": [[ 0, "asc" ]],
			    		"searching": false,
			    		"language": {
						    "emptyTable": "Aucune facture n'est enregistrée",
						    "search":         "Rechercher :",
						    "info":           "Données de _START_ à _END_ sur _TOTAL_ entrées",
    						"infoEmpty":      "Données 0 à 0 sur 0 entrée"
						}
		    		});

	$(document).ready( function () { data_tab } );

	$(document).ready( function () { data_tab_fac } );

	$(document).ready( function () { data_tab_conf } );

</script>
{% endblock %}

{% block body %} 
{% if user.is_authenticated and user.id == parent.uid_id or user.is_superuser %}
<div class="d-flex justify-content-center pt-3">
 <div class="bg-light p-4 border border-secondary rounded">
	<h1>{{ parent.fullname}}</h1>
	<h2>Informations personnelles</h2>
	<form action="{% url 'parent_update' parent.uid_id  %}" method="post" class="pt-3">
		{% csrf_token %}
		<table>
		{{ personal_data_form.as_table }}
		</table>

		<input type="submit" value="Valider" class="btn btn-primary">
	</form>

<div class="pt-3">
	<h2>Enfants inscrits</h2>
	<table id="parent_profile_enfant_tab" class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Enfant</th>
				<th> Options </th>
			</tr>
		</thead>
		<tbody>
	{% for child in parent.child_set.all %}
		<tr>
			<td>
				<a href={% url 'child_profile' child.id %}>
					{{child.fullname}}
				</a> 
			</td>
			<td>
				<form method="POST" action="{% url 'child_delete' child.id  %}?next={{request.path}}">
	 				{% csrf_token %}
	 				<input type="submit" value="X" class="btn btn-danger btn-sm">
				</form>
			</td>
		</tr>
	{% endfor %}
	</tbody>
	</table>
</div>

<div class="pt-3">
	<h2>Personnes de confiance</h2>
	<table id="parent_profile_confiance_tab" class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Personnes</th>
				<th>Options</th>
			</tr>
		</thead>
	{% for person in parent.reliableperson_set.all %}
		<tr>
			<td>
					{{person.fullname}}
			</td>
			<td>
				<form method="POST" action="{% url 'reliable_person_delete' person.id %}?next={{request.path}}">
	 				{% csrf_token %}
	 				<input type="submit" value="X" class="btn btn-danger btn-sm">
				</form>
			</td>
		</tr>
	{% endfor %}
	</table>
</div>
<div class="pt-3">
	<h2>Facture du mois par enfant</h2>
	<table id="parent_profile_facture_tab" class="table table-striped table-bordered">
		<thead>
			<tr>
				<th>Facture du mois par enfant</th>
				<th>Mois</th>
				<th>Montant</th>
			</tr>
		</thead>
		<tbody>
		{% for child in parent.child_set.all %}
			
			{% with bill=child.last_bill %}
			{% if bill %}
			<tr>
				<td>
						{{child.fullname}}
				</td>
				<td>
					{{bill.month|stringformat:'02d'}}/{{bill.year}}
				</td>
				<td>
					{{bill.amount}}€
				</td>
			</tr>
			{% endif %}
			{% endwith %}
			
		{% endfor %}
	</tbody>
	</table>

	<button class="btn btn-secondary btn-sm" data-toggle="modal" data-target="#factureModal">Détail</button>

</div>

	{% if user.id == parent.uid_id %}
		<div class="pt-3">
			<h3>Inscrire un enfant</h3>
			<form action="{% url 'parent_create_child' parent.uid_id  %}" method="post">
				{% csrf_token %}
				<table>
				{{ new_child_form.as_table }}
				</table>

				<input type="submit" value="Valider" class="btn btn-primary">
			</form>
		</div>
			
			
			
			
		<div class="pt-3">
			<h3>Ajouter une personne de confiance</h3>
			<form action="{% url 'parent_create_reliable' parent.uid_id  %}" method="post">
				{% csrf_token %}
				<table>
				{{ new_reliable_form.as_table }}
				</table>

				<input type="submit" value="Valider" class="btn btn-primary">
			</form>
		</div>
	{% endif %}
{% endif %}
</div>
</div>

<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="factureModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Facture du mois</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body border border-secondary">
      	<!-- Bloc en-tête info -->
        <div class="d-flex justify-content-between">
        	<!-- Bloc info des parents -->
        	<div class="container">
			  	<div class="row">
			    	<div class="col">
			    		Nom
			    	</div>
				</div>
				<div class="row">
			    	<div class="col">
			    		Prénom
			    	</div>
				</div>
				<div class="row pt-3">
			    	<div class="col">
			    		Date: 01/2001
			    	</div>
				</div>
			</div>

			<!-- Bloc info de la Garderie -->
			<div class="container">
			  	<div class="row">
			    	<div class="col">
			    		Nom de la Garderie ?
			    	</div>
				</div>
				<div class="row">
			    	<div class="col">
			    		Adresse ?
			    	</div>
				</div>
			</div>
        </div>

        <div class="container">
	        <!-- Un tableau par enfant -->
	        <h4 class="pt-3">Mois de Titouan</h4>
	        <table id="modal_facture" class="table table-striped table-bordered">
				<thead>
					<tr>
						<th>Date</th>
						<th>Heure</th>
						<th>Montant</th>
					</tr>
				</thead>
					<!-- for... -->
					<tr>
						<td>01/01</td>
						<td>15h30 à 16h00</td>
						<td>45€</td>
					</tr>

					<tr>
						<td>02/01</td>
						<td>15h30 à 16h00</td>
						<td>27€</td>
					</tr>
					<tr>
						<td>03/01</td>
						<td>15h30 à 16h00</td>
						<td>27€</td>
					</tr>
					<tr>
						<td>04/01</td>
						<td>15h30 à 16h00</td>
						<td>27€</td>
					</tr>

					<tfoot>
						<tr>
							<th colspan="2">Total :</th>
							<th>200€</th>
						</tr>
					</tfoot>
			</table>
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-outline-danger">Télécharger en PDF</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{%}
